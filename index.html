<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✨ SP04 Spreadsheet Wars Special Piece IV：我不想等飛機真的下墜時，才開始去搶降落傘！</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for better readability */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            color: #374151; /* Dark gray text */
            line-height: 1.6;
        }
        .container {
            max-width: 960px; /* Max width for content */
            margin: 0 auto; /* Center the container */
            padding: 1.5rem;
        }
        .section-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1f2937; /* Darker gray for titles */
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .subsection-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #374151;
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb; /* Light border */
            padding-bottom: 0.5rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* shadow-md */
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .item-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid for items */
            gap: 1rem;
        }

        /* Item card base styles */
        .item-card {
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            display: flex;
            flex-direction: column; /* Allow content to stack */
            justify-content: space-between;
            align-items: flex-start; /* Align text to left */
            font-size: 0.95rem;
            position: relative; /* For tooltip positioning */
            overflow: visible; /* Ensure tooltip is not clipped */
            text-decoration: none; /* Remove underline for links */
            color: inherit; /* Inherit text color for links */
            transition: border-width 0.2s ease-in-out, background-color 0.2s ease-in-out, transform 0.2s ease-in-out; /* Smooth transitions */
        }
        .item-card:hover {
            transform: translateY(-3px); /* Slight lift effect on hover */
        }

        /* Border thickness for links */
        .item-card.no-link {
            border-width: 1px; /* Thin border */
        }
        .item-card.has-link {
            border-width: 3px; /* Thick border */
        }

        /* Color categories */
        .category-water {
            background-color: #e0f2fe; /* light blue */
            border-color: #90cdf4; /* blue-300 */
        }
        .category-medical {
            background-color: #fee2e2; /* light red */
            border-color: #fca5a5; /* red-300 */
        }
        .category-food {
            background-color: #fffde7; /* light yellow */
            border-color: #fcd34d; /* yellow-300 */
        }
        .category-fuel {
            background-color: #fff7ed; /* light orange */
            border-color: #fdba74; /* orange-300 */
        }
        .category-other {
            background-color: #f3f4f6; /* light gray */
            border-color: #d1d5db; /* gray-300 */
        }

        /* Tooltip styles */
        .item-card .tooltip-details {
            visibility: hidden;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 0.75rem;
            position: absolute;
            z-index: 10;
            bottom: 100%; /* Position above the item */
            left: 50%;
            transform: translateX(-50%) translateY(-0.5rem); /* Adjust position slightly above */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            white-space: nowrap; /* Prevent text wrapping */
            pointer-events: none; /* Allow clicks through tooltip */
        }
        .item-card:hover .tooltip-details {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(-1rem); /* Move up slightly on hover */
        }
        .item-card .tooltip-details::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -0.375rem; /* Half of border-width for centering */
            border-width: 0.375rem;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }

        /* Text colors inside item card */
        .item-card strong {
            color: #1f2937; /* Darker text for item name */
        }
        .item-card span {
            color: #ef4444; /* Red for cost */
            font-weight: 500;
        }
        .footer-text {
            font-size: 1rem;
            text-align: center;
            margin-top: 3rem;
            color: #6b7280;
        }
        .item-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            width: 100%; /* Ensure controls take full width */
            justify-content: space-between; /* Space out checkbox and quantity */
        }
        .item-controls input[type="checkbox"] {
            transform: scale(1.2); /* Slightly larger checkbox */
            cursor: pointer;
        }
        .item-controls input[type="number"] {
            width: 4rem; /* Fixed width for quantity input */
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            text-align: center;
            -moz-appearance: textfield; /* Hide arrows in Firefox */
        }
        /* Hide arrows in Chrome, Safari, Edge */
        .item-controls input[type="number"]::-webkit-outer-spin-button,
        .item-controls input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .item-card.checked {
            opacity: 0.7; /* Dim checked items */
            background-color: #f0fdf4; /* Light green for checked items */
            border-color: #86efac; /* Green border for checked items */
        }
    </style>
</head>
<body class="antialiased">
    <div class="container">
        <!-- Header Section -->
        <header class="py-8 text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight mb-4 rounded-lg p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg">
                ✨ SP04《Spreadsheet Wars Special Piece IV：我不想等飛機真的下墜時，才開始去搶降落傘！》
            </h1>
            <p class="text-xl md:text-2xl text-gray-700 font-medium mb-8">
                台灣正處於平行時空的分歧點。就像一部多重宇宙電影，現在的一念選擇，將開啟未來截然不同的世界線。
            </p>
        </header>

        <!-- Progress Summary Section -->
        <section class="card mb-8 p-6 bg-blue-50 border-l-4 border-blue-400">
            <h2 class="text-2xl font-semibold text-blue-800 mb-4">我的防災包進度</h2>
            <p class="text-lg text-blue-700">
                您已勾選 <span id="checkedItemsCount" class="font-bold text-3xl">0</span> 個品項，總計 <span id="totalItemsCount" class="font-bold text-3xl">0</span> 個。
            </p>
            <p class="text-sm text-blue-600 mt-2">
                繼續努力，讓您的家庭更安全！
            </p>
        </section>

        <!-- Introduction Section -->
        <section class="card">
            <h2 class="section-title">引言</h2>
            <blockquote class="text-lg italic text-gray-600 mb-6 border-l-4 border-blue-500 pl-4">
                「在戰爭與屈辱面前，你選擇了屈辱！可是，屈辱過後，你仍得面對戰爭！」
                <footer class="mt-2 text-sm text-gray-500">— 已故英國首相，溫斯頓·丘吉爾(1938)</footer>
            </blockquote>
            <p class="mb-4">
                這篇文章探討了如果你知道一個選擇可能導致兩條完全不同的世界線，你會選擇提早準備，還是袖手旁觀繼續等待？
            </p>
            <p class="mb-4">
                作者近兩個月進行了一項「希望永遠用不到，但一旦需要就關乎生死」的任務：準備家庭災難包。
            </p>
            <p class="mb-4">
                準備這些真的很耗神、耗錢也耗時間，可能得花費一整個月的薪水。但換來的，是內心的安定感，還有當意外發生時，不至於只能手忙腳亂搶物資，避免等別人告訴你怎麼辦的那種被動感。
            </p>
            <p class="mb-4">
                颱風、地震、疫情，大家都會做一點準備，但面對更極端且複合式的風險，反而會因為太沉重，而選擇壓抑與忽略不安。但事實上，戰爭就是最高強度的綜合災難：水電中斷、物資短缺、資訊封鎖、網路癱瘓、醫療癱瘓、交通停擺、財產喪失、人身威脅，以及各種型態的暴力與侵害。不管你的身分與價值觀，這些災難都不會先敲門詢問你的同意：「Hey, bro! Do you want a battle?」
            </p>
            <p>
                我希望自己能做決定，而不是在別人決定後被迫接受結果。生存與尊嚴，也應該是我們主動做出的選擇，而不是寄託敵人的仁慈與善意，或讓他人替我們規劃。
            </p>
        </section>

        <!-- Disaster Kit Contents Section -->
        <section class="card">
            <h2 class="section-title">防災包內容清單</h2>
            <p class="mb-6 text-center text-gray-600">
                「準備不完全，也勝過完全不準備」— 這是一份我們為家庭準備的防災包清單，希望能為您提供一些參考。
            </p>

            <h3 class="subsection-title">核心必需品</h3>
            <ul class="list-disc list-inside text-gray-700 mb-6 space-y-2">
                <li>飲水</li>
                <li>糧食</li>
                <li>醫療用品</li>
                <li>衛生用品</li>
                <li>能源燃料</li>
                <li>通訊設備</li>
                <li>避難地點規劃</li>
            </ul>

            <h3 class="subsection-title">詳細品項與預估金額 (參考)</h3>
            <div id="disaster-kit-items-container" class="item-list">
                <!-- Items will be dynamically generated here by JavaScript -->
            </div>
            <p class="mt-6 text-center text-gray-600 italic">
                ※ 推薦購買來源將在後續整理更完整後附上。
            </p>
        </section>

        <!-- Conclusion Section -->
        <section class="card">
            <h2 class="section-title">結語</h2>
            <p class="mb-4">
                如果也曾經覺得焦慮，不妨貼近「第一性原理」來思考：
            </p>
            <ul class="list-disc list-inside text-gray-700 mb-6 space-y-2">
                <li>你真正的焦慮與擔心是什麼？（生命財產？生活方式？下一代？…）</li>
                <li>讓你不安的因素來自哪裡？（人？事？物？…）</li>
                <li>你現在能做的有什麼？（強化個體韌性？家庭準備？祈禱？…）</li>
            </ul>
            <p class="mb-4">
                這些問題的答案，每個人應該不會一樣，但能幫助我們釐清──什麼是讓你焦慮的源頭？什麼行動能讓你感到安心？
            </p>
            <p class="mb-6 text-center text-lg font-semibold text-blue-700">
                「當飛機開始下墜時，你要等別人遞給你降落傘？還是現在，就為自己準備一把？」
            </p>
            <p class="mb-4 text-center">
                站出來，就是選擇不依賴別人的善意替你決定未來！
            </p>
            <p class="footer-text">
                ──SpreadSheetWars SP04，航行日誌紀錄完成。──
            </p>
            <p class="footer-text mt-4">
                🔁 若您覺得這篇內容對您或您的家人有所幫助，歡迎分享、轉貼或重製。
            </p>
            <p class="footer-text">
                🧩 國家的韌性，從每個家庭的準備開始。
            </p>
            <p class="footer-text">
                ✨ 願民主與繁榮與我們同在──直到永遠！
            </p>
        </section>

        <footer class="py-8 text-center text-gray-500 text-sm">
            <p>&copy; 2025 Spreadsheet Wars. All rights reserved.</p>
            <p>#災難準備 #防衛意識 #第一性原理 #家庭責任 #SpreadSheetWars</p>
            <p>#DisasterPreparedness #DefenseAwareness #FirstPrinciples #FamilyResponsibility #SpreadSheetWars</p>
        </footer>
    </div>

    <script>
        // Define the disaster kit items data
        // 為了方便管理和互動，將品項資料定義為 JavaScript 物件陣列
        const disasterKitItems = [
            // Other Category
            { id: 'item-01', name: '黑熊學院 避難防災用品', price: 14530, category: 'other', details: '提供防災知識與實用課程', link: '' },
            { id: 'item-02', name: '晴讀_京品源避難防災用品', price: 5589, category: 'other', details: '綜合性防災用品供應商', link: '' },
            { id: 'item-03', name: '蝦皮_防煙頭罩 x3', price: 1100, category: 'other', details: '火災逃生用，保護呼吸道', link: 'https://example.com/smoke-hood' },
            { id: 'item-04', name: '蝦皮_簡易廁所50次', price: 975, category: 'other', details: '應急衛生用品，方便處理排泄物', link: '' },
            { id: 'item-05', name: '蝦皮_ADISI防水雨披+睡袋', price: 1380, category: 'other', details: '應急保暖與防水，輕便易攜', link: '' },
            { id: 'item-06', name: '蝦皮_簡易尿袋*2', price: 157, category: 'other', details: '應急衛生用品，方便使用', link: '' },
            { id: 'item-07', name: '京品源_加購防災用品+運費120', price: 1760, category: 'other', details: '防災用品補充與運費', link: '' },
            { id: 'item-08', name: '蝦皮_鈦金屬筷子(560)+叉匙(465)-折扣(263)', price: 762, category: 'other', details: '輕量耐用，戶外用餐工具', link: 'https://example.com/titanium-cutlery' },
            { id: 'item-09', name: '蝦皮_ADi AV-03免執照對講機2隻一組', price: 2514, category: 'other', details: '緊急通訊設備，免執照使用', link: 'https://example.com/walkie-talkie' },

            // Water Category
            { id: 'item-10', name: '蝦皮_MochiGoo防水水壺8L x8個', price: 1172, category: 'water', details: '大容量儲水，輕便可折疊', link: 'https://example.com/mochigoo-water-bag' },
            { id: 'item-11', name: '蝦皮_防災濾水罐 x2+生存口嚼片(24顆裝) x2', price: 2361, category: 'water', details: '淨化水源，提供緊急能量', link: 'https://example.com/water-filter-kit' },
            { id: 'item-12', name: 'P&G防災濾水粉 x2份', price: 1528, category: 'water', details: '快速淨化飲用水', link: '' },
            { id: 'item-13', name: '蝦皮_生命吸管(810) x3隻', price: 2430, category: 'water', details: '個人濾水器，直接飲用安全水', link: 'https://example.com/lifestraw-810' },
            { id: 'item-14', name: '蝦皮_KATADYN過濾孢囊(30顆裝) x2', price: 1275, category: 'water', details: '高效濾水片，適用於野外水源', link: '' },
            { id: 'item-15', name: '蝦皮_WaterBOB浴缸儲水袋*1', price: 2200, category: 'water', details: '大容量應急儲水袋，利用浴缸空間', link: '' },
            { id: 'item-16', name: '蝦皮_LifeStrawPeak生命吸管*1', price: 1200, category: 'water', details: '高效個人濾水器，輕巧便攜', link: '' },

            // Medical Category
            { id: 'item-17', name: '藥局_抗生素軟膏', price: 180, category: 'medical', details: '外傷感染預防與治療', link: '' },
            { id: 'item-18', name: '杏一_藥品一批', price: 883, category: 'medical', details: '常用藥品與急救用品組合', link: '' },
            { id: 'item-19', name: '美泰德_藥品一批', price: 497, category: 'medical', details: '常用藥品與急救用品組合', link: '' },

            // Food Category
            { id: 'item-20', name: '蝦皮_POW-R1能量磚(250g) x16份', price: 4480, category: 'food', details: '高能量壓縮餅乾，提供持久飽足感', link: 'https://example.com/pow-r1-16' },
            { id: 'item-21', name: '蝦皮_POW-R1能量磚(250g) x4份', price: 1120, category: 'food', details: '高能量壓縮餅乾，提供持久飽足感', link: '' },
            { id: 'item-22', name: '蝦皮_生存口嚼片(24顆裝) x2', price: 1122, category: 'food', details: '緊急能量補充，快速提供熱量', link: '' },
            { id: 'item-23', name: '蝦皮_NRG-5戰備口糧*1', price: 890, category: 'food', details: '長期儲存口糧，營養均衡', link: '' },

            // Fuel/Energy Category
            { id: 'item-24', name: '蝦皮_電池', price: 807, category: 'fuel', details: '應急電源，多種尺寸備用', link: 'https://example.com/batteries' },
            { id: 'item-25', name: '蝦皮_CampMaid固體燃料塊(12顆裝) x5 +鈦合金湯匙', price: 744, category: 'fuel', details: '輕便燃料，用於加熱食物或水', link: 'https://example.com/campmaid-fuel' },
            { id: 'item-26', name: '蝦皮_戰術電弧點火手電筒*2', price: 1580, category: 'fuel', details: '多功能點火與照明工具', link: 'https://example.com/tactical-flashlight' },
        ];

        // Function to get saved state from Local Storage
        function getSavedState() {
            try {
                const savedState = localStorage.getItem('disasterKitState');
                return savedState ? JSON.parse(savedState) : {};
            } catch (e) {
                console.error("Error loading state from Local Storage:", e);
                return {};
            }
        }

        // Function to save state to Local Storage
        function saveState(state) {
            try {
                localStorage.setItem('disasterKitState', JSON.stringify(state));
            } catch (e) {
                console.error("Error saving state to Local Storage:", e);
            }
        }

        // Initialize items with saved state
        let currentItemsState = getSavedState();
        disasterKitItems.forEach(item => {
            if (currentItemsState[item.id]) {
                item.checked = currentItemsState[item.id].checked;
                item.quantity = currentItemsState[item.id].quantity;
            } else {
                item.checked = false; // Default to unchecked
                item.quantity = 1;    // Default quantity
            }
        });

        // Function to render/re-render the item list
        function renderDisasterKitItems() {
            const container = document.getElementById('disaster-kit-items-container');
            container.innerHTML = ''; // Clear existing items

            disasterKitItems.forEach(item => {
                const isLink = item.link && item.link.length > 0;
                const itemElement = document.createElement(isLink ? 'a' : 'div'); // Use <a> for links, <div> otherwise
                if (isLink) {
                    itemElement.href = item.link;
                    itemElement.target = '_blank'; // Open in new tab
                    itemElement.rel = 'noopener noreferrer'; // Security best practice for target="_blank"
                }

                itemElement.className = `item-card ${isLink ? 'has-link' : 'no-link'} category-${item.category} ${item.checked ? 'checked' : ''}`;
                itemElement.setAttribute('data-id', item.id); // Store item ID for easy lookup

                itemElement.innerHTML = `
                    <div class="flex justify-between w-full items-center">
                        <strong class="text-gray-900">${item.name}</strong>
                        <span class="text-red-500 font-semibold">-${item.price}</span>
                    </div>
                    <div class="tooltip-details">${item.details}</div>
                    <div class="item-controls">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="item-checkbox" ${item.checked ? 'checked' : ''}>
                            已準備
                        </label>
                        <div class="flex items-center gap-1">
                            <label for="quantity-${item.id}">數量:</label>
                            <input type="number" id="quantity-${item.id}" class="item-quantity" value="${item.quantity}" min="1">
                        </div>
                    </div>
                `;

                container.appendChild(itemElement);

                // Add event listeners for checkbox and quantity input
                const checkbox = itemElement.querySelector('.item-checkbox');
                const quantityInput = itemElement.querySelector('.item-quantity');

                checkbox.addEventListener('change', (event) => {
                    item.checked = event.target.checked;
                    itemElement.classList.toggle('checked', item.checked);
                    updateStateAndSummary();
                });

                quantityInput.addEventListener('change', (event) => {
                    let newQuantity = parseInt(event.target.value, 10);
                    if (isNaN(newQuantity) || newQuantity < 1) {
                        newQuantity = 1; // Ensure quantity is at least 1
                        event.target.value = 1;
                    }
                    item.quantity = newQuantity;
                    updateStateAndSummary();
                });
            });
            updateSummary(); // Initial summary update after rendering
        }

        // Function to update the summary section and save state
        function updateStateAndSummary() {
            // Update currentItemsState based on disasterKitItems
            disasterKitItems.forEach(item => {
                currentItemsState[item.id] = {
                    checked: item.checked,
                    quantity: item.quantity
                };
            });
            saveState(currentItemsState); // Save the updated state
            updateSummary(); // Update the displayed summary
        }

        // Function to update the progress summary
        function updateSummary() {
            const checkedItems = disasterKitItems.filter(item => item.checked);
            const checkedCount = checkedItems.length;
            const totalCount = disasterKitItems.length;

            document.getElementById('checkedItemsCount').textContent = checkedCount;
            document.getElementById('totalItemsCount').textContent = totalCount;
        }

        // Initial render when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            renderDisasterKitItems();
        });
    </script>
</body>
</html>
