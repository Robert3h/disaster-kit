<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✨ SP04 Spreadsheet Wars Special Piece IV：我不想等飛機真的下墜時，才開始去搶降落傘！</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for better readability */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            color: #374151; /* Dark gray text */
            line-height: 1.6;
        }
        .container {
            max-width: 960px; /* Max width for content */
            margin: 0 auto; /* Center the container */
            padding: 1.5rem;
        }
        .section-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1f2937; /* Darker gray for titles */
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .subsection-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #374151;
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb; /* Light border */
            padding-bottom: 0.5rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* shadow-md */
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .item-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid for items */
            gap: 1rem;
        }

        /* Item card base styles */
        .item-card {
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            display: flex;
            flex-direction: column; /* Allow content to stack */
            justify-content: space-between;
            align-items: flex-start; /* Align text to left */
            font-size: 0.95rem;
            position: relative; /* For tooltip positioning */
            overflow: visible; /* Ensure tooltip is not clipped */
            text-decoration: none; /* Remove underline for links */
            color: inherit; /* Inherit text color for links */
            transition: border-width 0.2s ease-in-out, background-color 0.2s ease-in-out, transform 0.2s ease-in-out; /* Smooth transitions */
        }
        .item-card:hover {
            transform: translateY(-3px); /* Slight lift effect on hover */
        }

        /* Border thickness for links */
        .item-card.no-link {
            border-width: 1px; /* Thin border */
        }
        .item-card.has-link {
            border-width: 3px; /* Thick border */
        }

        /* Color categories */
        .category-water {
            background-color: #e0f2fe; /* light blue */
            border-color: #90cdf4; /* blue-300 */
        }
        .category-medical {
            background-color: #fee2e2; /* light red */
            border-color: #fca5a5; /* red-300 */
        }
        .category-food {
            background-color: #fffde7; /* light yellow */
            border-color: #fcd34d; /* yellow-300 */
        }
        .category-fuel {
            background-color: #fff7ed; /* light orange */
            border-color: #fdba74; /* orange-300 */
        }
        .category-other {
            background-color: #f3f4f6; /* light gray */
            border-color: #d1d5db; /* gray-300 */
        }

        /* Tooltip styles */
        .item-card .tooltip-details {
            visibility: hidden;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 0.75rem;
            position: absolute;
            z-index: 10;
            bottom: 100%; /* Position above the item */
            left: 50%;
            transform: translateX(-50%) translateY(-0.5rem); /* Adjust position slightly above */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            white-space: nowrap; /* Prevent text wrapping */
            pointer-events: none; /* Allow clicks through tooltip */
        }
        .item-card:hover .tooltip-details {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(-1rem); /* Move up slightly on hover */
        }
        .item-card .tooltip-details::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -0.375rem; /* Half of border-width for centering */
            border-width: 0.375rem;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }

        /* Text colors inside item card */
        .item-card strong {
            color: #1f2937; /* Darker text for item name */
        }
        .item-card span {
            color: #ef4444; /* Red for cost */
            font-weight: 500;
        }
        .footer-text {
            font-size: 1rem;
            text-align: center;
            margin-top: 3rem;
            color: #6b7280;
        }
        .item-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            width: 100%; /* Ensure controls take full width */
            justify-content: space-between; /* Space out checkbox and quantity */
        }
        .item-controls input[type="checkbox"] {
            transform: scale(1.2); /* Slightly larger checkbox */
            cursor: pointer;
        }
        .item-controls input[type="number"] {
            width: 4rem; /* Fixed width for quantity input */
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            text-align: center;
            -moz-appearance: textfield; /* Hide arrows in Firefox */
        }
        /* Hide arrows in Chrome, Safari, Edge */
        .item-controls input[type="number"]::-webkit-outer-spin-button,
        .item-controls input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .item-card.checked {
            opacity: 0.7; /* Dim checked items */
            background-color: #f0fdf4; /* Light green for checked items */
            border-color: #86efac; /* Green border for checked items */
        }
    </style>
</head>
<body class="antialiased">
    <div class="container">
        <!-- Header Section -->
        <header class="py-8 text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight mb-4 rounded-lg p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg">
                ✨ SP04《Spreadsheet Wars Special Piece IV：我不想等飛機真的下墜時，才開始去搶降落傘！》
            </h1>
            <p class="text-xl md:text-2xl text-gray-700 font-medium mb-8">
                台灣正處於平行時空的分歧點。就像一部多重宇宙電影，現在的一念選擇，將開啟未來截然不同的世界線。
            </p>
        </header>

        <!-- Progress Summary Section -->
        <section class="card mb-8 p-6 bg-blue-50 border-l-4 border-blue-400">
            <h2 class="text-2xl font-semibold text-blue-800 mb-4">我的防災包進度</h2>
            <p class="text-lg text-blue-700">
                您已勾選 <span id="checkedItemsCount" class="font-bold text-3xl">0</span> 個品項，總計 <span id="totalItemsCount" class="font-bold text-3xl">0</span> 個。
            </p>
            <p class="text-lg text-blue-700 mt-2">
                已勾選品項預估總金額：<span id="totalEstimatedCost" class="font-bold text-3xl text-red-600">NT$ 0</span>
            </p>
            <p class="text-sm text-blue-600 mt-2">
                繼續努力，讓您的家庭更安全！
            </p>
        </section>

        <!-- Introduction Section -->
        <section class="card">
            <h2 class="section-title">引言</h2>
            <blockquote class="text-lg italic text-gray-600 mb-6 border-l-4 border-blue-500 pl-4">
                「在戰爭與屈辱面前，你選擇了屈辱！可是，屈辱過後，你仍得面對戰爭！」
                <footer class="mt-2 text-sm text-gray-500">— 已故英國首相，溫斯頓·丘吉爾(1938)</footer>
            </blockquote>
            <p class="mb-4">
                這篇文章探討了如果你知道一個選擇可能導致兩條完全不同的世界線，你會選擇提早準備，還是袖手旁觀繼續等待？
            </p>
            <p class="mb-4">
                作者近兩個月進行了一項「希望永遠用不到，但一旦需要就關乎生死」的任務：準備家庭災難包。
            </p>
            <p class="mb-4">
                準備這些真的很耗神、耗錢也耗時間，可能得花費一整個月的薪水。但換來的，是內心的安定感，還有當意外發生時，不至於只能手忙腳亂搶物資，避免等別人告訴你怎麼辦的那種被動感。
            </p>
            <p class="mb-4">
                颱風、地震、疫情，大家都會做一點準備，但面對更極端且複合式的風險，反而會因為太沉重，而選擇壓抑與忽略不安。但事實上，戰爭就是最高強度的綜合災難：水電中斷、物資短缺、資訊封鎖、網路癱瘓、醫療癱瘓、交通停擺、財產喪失、人身威脅，以及各種型態的暴力與侵害。不管你的身分與價值觀，這些災難都不會先敲門詢問你的同意：「Hey, bro! Do you want a battle?」
            </p>
            <p>
                我希望自己能做決定，而不是在別人決定後被迫接受結果。生存與尊嚴，也應該是我們主動做出的選擇，而不是寄託敵人的仁慈與善意，或讓他人替我們規劃。
            </p>
        </section>

        <!-- Disaster Kit Contents Section -->
        <section class="card">
            <h2 class="section-title">防災包內容清單</h2>
            <p class="mb-6 text-center text-gray-600">
                「準備不完全，也勝過完全不準備」— 這是一份我們為家庭準備的防災包清單，希望能為您提供一些參考。
            </p>

            <h3 class="subsection-title">核心必需品</h3>
            <ul class="list-disc list-inside text-gray-700 mb-6 space-y-2">
                <li>飲水</li>
                <li>糧食</li>
                <li>醫療用品</li>
                <li>衛生用品</li>
                <li>能源燃料</li>
                <li>通訊設備</li>
                <li>避難地點規劃</li>
            </ul>

            <h3 class="subsection-title">詳細品項與預估金額 (參考)</h3>
            <div id="disaster-kit-items-container" class="item-list">
                <!-- Items will be dynamically generated here by JavaScript -->
            </div>
            <p class="mt-6 text-center text-gray-600 italic">
                ※ 推薦購買來源將在後續整理更完整後附上。
            </p>
        </section>

        <!-- Conclusion Section -->
        <section class="card">
            <h2 class="section-title">結語</h2>
            <p class="mb-4">
                如果也曾經覺得焦慮，不妨貼近「第一性原理」來思考：
            </p>
            <ul class="list-disc list-inside text-gray-700 mb-6 space-y-2">
                <li>你真正的焦慮與擔心是什麼？（生命財產？生活方式？下一代？…）</li>
                <li>讓你不安的因素來自哪裡？（人？事？物？…）</li>
                <li>你現在能做的有什麼？（強化個體韌性？家庭準備？祈禱？…）</li>
            </ul>
            <p class="mb-4">
                這些問題的答案，每個人應該不會一樣，但能幫助我們釐清──什麼是讓你焦慮的源頭？什麼行動能讓你感到安心？
            </p>
            <p class="mb-6 text-center text-lg font-semibold text-blue-700">
                「當飛機開始下墜時，你要等別人遞給你降落傘？還是現在，就為自己準備一把？」
            </p>
            <p class="mb-4 text-center">
                站出來，就是選擇不依賴別人的善意替你決定未來！
            </p>
            <p class="footer-text">
                ──SpreadSheetWars SP04，航行日誌紀錄完成。──
            </p>
            <p class="footer-text mt-4">
                � 若您覺得這篇內容對您或您的家人有所幫助，歡迎分享、轉貼或重製。
            </p>
            <p class="footer-text">
                🧩 國家的韌性，從每個家庭的準備開始。
            </p>
            <p class="footer-text">
                ✨ 願民主與繁榮與我們同在──直到永遠！
            </p>
        </section>

        <footer class="py-8 text-center text-gray-500 text-sm">
            <p>&copy; 2025 Spreadsheet Wars. All rights reserved.</p>
            <p>#災難準備 #防衛意識 #第一性原理 #家庭責任 #SpreadSheetWars</p>
            <p>#DisasterPreparedness #DefenseAwareness #FirstPrinciples #FamilyResponsibility #SpreadSheetWars</p>
        </footer>
    </div>

    <script>
        // Define the disaster kit items data
        // 為了方便管理和互動，將品項資料定義為 JavaScript 物件陣列
        const disasterKitItems = [
            // 飲水相關 (Water Category)
            { id: 'item-01', name: 'POW-R1能量磚(250g) x16份', price: 4480, category: 'food', details: '比利時 POW-R1 能量磚 x16份。可直接食用或加水沖泡。', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-03', name: '日本KOKUYO防災濾水器', price: 1100, category: 'water', details: '日本 KOKUYO 防災濾水器', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-05', name: '日本MochiGoo防水水壺8L x8個', price: 1172, category: 'water', details: '日本 MochiGoo 防水水壺 8L x8個', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-06', name: '美國Portable Aqua淨水劑(12顆/20升用)', price: 588, category: 'water', details: '美國 Portable Aqua 淨水劑 (12顆/20升用)', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-07', name: '美國Sawyer Mini濾水器', price: 2528, category: 'water', details: '美國 Sawyer Mini 濾水器', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-08', name: '美國LifeStraw濾水器', price: 1580, category: 'water', details: '美國 LifeStraw 濾水器', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-09', name: '美國Grayl過濾水壺', price: 1120, category: 'water', details: '美國 Grayl 過濾水壺', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-12', name: '美國LifeStrawPeak生命吸管', price: 2430, category: 'water', details: '美國 LifeStraw Peak 生命吸管', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-13', name: '台灣ADiS戶外淨水器+ADiS迷你濾水器', price: 1380, category: 'water', details: '台灣 ADiS 戶外淨水器 + ADiS 迷你濾水器', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-17', name: '美國KATADYN過濾孢囊(30顆裝)', price: 1275, category: 'water', details: '美國 KATADYN 過濾孢囊 (30顆裝)', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-19', name: '美國Sawyer Mini濾水器', price: 1122, category: 'water', details: '美國 Sawyer Mini 濾水器', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-20', name: '美國WaterBOB浴缸儲水袋', price: 2200, category: 'water', details: '美國 WaterBOB 浴缸儲水袋', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-22', name: '美國LifeStrawPeak生命吸管', price: 1200, category: 'water', details: '美國 LifeStrawPeak 生命吸管', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-25', name: '台灣ADiS防災濾水器+ADiS迷你濾水器', price: 1760, category: 'water', details: '台灣 ADiS 防災濾水器 + ADiS 迷你濾水器', link: 'http://robert3h.github.io/disaster-kit/' },

            // 醫療衛生 (Medical Category)
            { id: 'item-02', name: '日本SATAKE乾燥飯', price: 5589, category: 'medical', details: '日本 SATAKE 驅蚊貼', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-10', name: '常用抗生素軟膏', price: 975, category: 'medical', details: '常用抗生素軟膏', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-11', name: '台灣ADiS防水雨披+睡袋', price: 180, category: 'medical', details: '日本 ADiS 防水雨披 + 睡袋', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-14', name: '杏一藥品', price: 883, category: 'medical', details: '杏一藥品', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-15', name: '美泰德藥品', price: 497, category: 'medical', details: '美泰德藥品', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-16', name: '簡易尿袋(2個)', price: 157, category: 'medical', details: '簡易尿袋 (2個)', link: 'http://robert3h.github.io/disaster-kit/' },

            // 飲食相關 (Food Category)
            { id: 'item-23', name: '美國NRG-5戰備口糧', price: 890, category: 'food', details: '美國 NRG-5 戰備口糧', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-24', name: '德國POW-R1能量磚(250g) x4份', price: 1110, category: 'food', details: '日本 POW-R1 能量磚 (250g) x4份', link: 'http://robert3h.github.io/disaster-kit/' },

            // 能源燃料 (Fuel Category)
            { id: 'item-04', name: '日本Panasonic EVOLTA鈦元素鹼性電池', price: 807, category: 'fuel', details: 'EVAPORAMA EVOLTA 可攜帶型電池', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-18', name: '美國CampMaid固體燃料塊(12顆裝) x5 +美國MontBell鈦合金湯匙', price: 744, category: 'fuel', details: '美國 CampMaid 固體燃料塊 (12顆裝) x5 + 鈦合金湯匙', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-21', name: '美國戰術電弧點火手電筒', price: 1580, category: 'fuel', details: '美國 戰術電弧點火手電筒', link: 'http://robert3h.github.io/disaster-kit/' },

            // 其他 (Other Category)
            { id: 'item-26', name: '中國Keith鈦金屬筷子(560)+叉匙(465)-折扣(263)', price: 762, category: 'other', details: '中國 Keith 鈦金屬筷子 (560) + 叉匙 (465) - 折扣 (263)', link: 'http://robert3h.github.io/disaster-kit/' },
            { id: 'item-27', name: '台灣ADi AV-03免執照對講機2隻一組', price: 2514, category: 'other', details: '台灣 ADi AV-03 免執照對講機 2隻一組', link: 'http://robert3h.github.io/disaster-kit/' },
        ];

        // Function to get saved state from Local Storage
        function getSavedState() {
            try {
                const savedState = localStorage.getItem('disasterKitState');
                return savedState ? JSON.parse(savedState) : {};
            } catch (e) {
                console.error("Error loading state from Local Storage:", e);
                return {};
            }
        }

        // Function to save state to Local Storage
        function saveState(state) {
            try {
                localStorage.setItem('disasterKitState', JSON.stringify(state));
            } catch (e) {
                console.error("Error saving state to Local Storage:", e);
            }
        }

        // Initialize items with saved state
        let currentItemsState = getSavedState();
        disasterKitItems.forEach(item => {
            if (currentItemsState[item.id]) {
                item.checked = currentItemsState[item.id].checked;
                item.quantity = currentItemsState[item.id].quantity;
            } else {
                item.checked = false; // Default to unchecked
                item.quantity = 1;    // Default quantity
            }
        });

        // Function to render/re-render the item list
        function renderDisasterKitItems() {
            const container = document.getElementById('disaster-kit-items-container');
            container.innerHTML = ''; // Clear existing items

            disasterKitItems.forEach(item => {
                const isLink = item.link && item.link.length > 0;
                const itemElement = document.createElement(isLink ? 'a' : 'div'); // Use <a> for links, <div> otherwise
                if (isLink) {
                    itemElement.href = item.link;
                    itemElement.target = '_blank'; // Open in new tab
                    itemElement.rel = 'noopener noreferrer'; // Security best practice for target="_blank"
                }

                itemElement.className = `item-card ${isLink ? 'has-link' : 'no-link'} category-${item.category} ${item.checked ? 'checked' : ''}`;
                itemElement.setAttribute('data-id', item.id); // Store item ID for easy lookup

                itemElement.innerHTML = `
                    <div class="flex justify-between w-full items-center">
                        <strong class="text-gray-900">${item.name}</strong>
                        <span class="text-red-500 font-semibold">-${item.price.toLocaleString('zh-TW')}</span>
                    </div>
                    <div class="tooltip-details">${item.details}</div>
                    <div class="item-controls">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="item-checkbox" ${item.checked ? 'checked' : ''}>
                            已準備
                        </label>
                        <div class="flex items-center gap-1">
                            <label for="quantity-${item.id}">數量:</label>
                            <input type="number" id="quantity-${item.id}" class="item-quantity" value="${item.quantity}" min="1">
                        </div>
                    </div>
                `;

                container.appendChild(itemElement);

                // Add event listeners for checkbox and quantity input
                const checkbox = itemElement.querySelector('.item-checkbox');
                const quantityInput = itemElement.querySelector('.item-quantity');

                checkbox.addEventListener('change', (event) => {
                    item.checked = event.target.checked;
                    itemElement.classList.toggle('checked', item.checked);
                    updateStateAndSummary();
                });

                quantityInput.addEventListener('change', (event) => {
                    let newQuantity = parseInt(event.target.value, 10);
                    if (isNaN(newQuantity) || newQuantity < 1) {
                        newQuantity = 1; // Ensure quantity is at least 1
                        event.target.value = 1;
                    }
                    item.quantity = newQuantity;
                    updateStateAndSummary();
                });
            });
            updateSummary(); // Initial summary update after rendering
        }

        // Function to update the summary section and save state
        function updateStateAndSummary() {
            // Update currentItemsState based on disasterKitItems
            disasterKitItems.forEach(item => {
                currentItemsState[item.id] = {
                    checked: item.checked,
                    quantity: item.quantity
                };
            });
            saveState(currentItemsState); // Save the updated state
            updateSummary(); // Update the displayed summary
        }

        // Function to update the progress summary
        function updateSummary() {
            const checkedItems = disasterKitItems.filter(item => item.checked);
            const checkedCount = checkedItems.length;
            const totalCount = disasterKitItems.length;
            
            let totalEstimatedCost = 0;
            checkedItems.forEach(item => {
                totalEstimatedCost += item.price * item.quantity;
            });

            document.getElementById('checkedItemsCount').textContent = checkedCount;
            document.getElementById('totalItemsCount').textContent = totalCount;
            document.getElementById('totalEstimatedCost').textContent = `NT$ ${totalEstimatedCost.toLocaleString('zh-TW')}`; // Format with NT$ and comma
        }

        // Initial render when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            renderDisasterKitItems();
        });
    </script>
</body>
</html>
