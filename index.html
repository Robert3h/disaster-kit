<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ SP04 Spreadsheet Wars Special Piece IVï¼šæˆ‘ä¸æƒ³ç­‰é£›æ©ŸçœŸçš„ä¸‹å¢œæ™‚ï¼Œæ‰é–‹å§‹å»æ¶é™è½å‚˜ï¼</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- jsPDF and html2canvas for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Chart.js for Pie Chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Custom font for better readability */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            color: #374151; /* Dark gray text */
            line-height: 1.6;
        }
        .container {
            max-width: 960px; /* Max width for content */
            margin: 0 auto; /* Center the container */
            padding: 1.5rem;
        }
        .section-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1f2937; /* Darker gray for titles */
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .subsection-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #374151;
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb; /* Light border */
            padding-bottom: 0.5rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* shadow-md */
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .item-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid for items */
            gap: 1rem;
        }

        /* Item card base styles */
        .item-card {
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            display: flex;
            flex-direction: column; /* Allow content to stack */
            justify-content: space-between;
            align-items: flex-start; /* Align text to left */
            font-size: 0.95rem;
            position: relative; /* For tooltip positioning */
            overflow: visible; /* Ensure tooltip is not clipped */
            text-decoration: none; /* Remove underline for links */
            color: inherit; /* Inherit text color for links */
            transition: border-width 0.2s ease-in-out, background-color 0.2s ease-in-out, transform 0.2s ease-in-out; /* Smooth transitions */
            cursor: pointer; /* Indicate clickable */
        }
        .item-card:hover {
            transform: translateY(-3px); /* Slight lift effect on hover */
        }

        /* Border thickness for links */
        .item-card.no-link {
            border-width: 1px; /* Thin border */
        }
        .item-card.has-link {
            border-width: 3px; /* Thick border */
        }

        /* Category specific colors (for item cards) */
        .category-æ¿¾æ°´èˆ‡å„²æ°´ { background-color: #e0f2fe; border-color: #90cdf4; } /* light blue */
        .category-é•·æ•ˆæœŸç³§é£Ÿ { background-color: #fffde7; border-color: #fcd34d; } /* light yellow */
        .category-è¡›ç”Ÿèˆ‡é†«ç™‚ { background-color: #fee2e2; border-color: #fca5a5; } /* light red */
        .category-ä¿æš–èˆ‡è¡£ { background-color: #e6fffa; border-color: #81e6d9; } /* light teal */
        .category-èƒ½æºèˆ‡ç‡ƒæ–™ { background-color: #fff7ed; border-color: #fdba74; } /* light orange */
        .category-é€šè¨Š { background-color: #ebf8ff; border-color: #63b3ed; } /* light sky blue */
        .category-é˜²ç«é€ƒç”Ÿ { background-color: #ffebe6; border-color: #feb2b2; } /* light coral */
        .category-åŸºç¤ç¶œåˆ { background-color: #f3f4f6; border-color: #d1d5db; } /* light gray */
        .category-é¤å…· { background-color: #f0f4f8; border-color: #a0aec0; } /* light blue-gray */
        .category-æœå°‹ä¸­ { background-color: #f7fafc; border-color: #e2e8f0; } /* very light gray */


        /* Tooltip styles */
        .item-card .tooltip-details {
            visibility: hidden;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: left; /* Align text to left inside tooltip */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 0.75rem;
            position: absolute;
            z-index: 10;
            bottom: 100%; /* Position above the item */
            left: 50%;
            transform: translateX(-50%) translateY(-0.5rem); /* Adjust position slightly above */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            white-space: normal; /* Allow text wrapping */
            min-width: 200px; /* Ensure tooltip is wide enough */
            max-width: 300px;
            pointer-events: none; /* Allow clicks through tooltip */
        }
        .item-card:hover .tooltip-details {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(-1rem); /* Move up slightly on hover */
        }
        .item-card .tooltip-details::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -0.375rem; /* Half of border-width for centering */
            border-width: 0.375rem;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }
        .tooltip-details ul {
            list-style: none; /* Remove default list bullets */
            padding: 0;
            margin: 0;
        }
        .tooltip-details li {
            margin-bottom: 0.25rem;
        }
        .tooltip-details li:last-child {
            margin-bottom: 0;
        }


        /* Text colors inside item card */
        .item-card strong {
            color: #1f2937; /* Darker text for item name */
            text-align: left; /* Align item name to left */
            width: 100%; /* Take full width */
        }
        .item-card .item-price-info {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            width: 100%;
            margin-top: 0.25rem;
        }
        .item-card .item-price {
            color: #ef4444; /* Red for cost */
            font-weight: 500;
            text-align: right; /* Align price to right */
        }
        .item-card .shelf-life {
            font-size: 0.8rem;
            color: #6b7280;
            text-align: right; /* Align shelf life to right */
        }
        .footer-text {
            font-size: 1rem;
            text-align: center;
            margin-top: 3rem;
            color: #6b7280;
        }
        .item-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            width: 100%; /* Ensure controls take full width */
            justify-content: space-between; /* Space out checkbox and quantity */
        }
        .item-controls input[type="checkbox"] {
            transform: scale(1.2); /* Slightly larger checkbox */
            cursor: pointer;
        }
        .item-controls input[type="number"] {
            width: 4rem; /* Fixed width for quantity input */
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            text-align: center;
            -moz-appearance: textfield; /* Hide arrows in Firefox */
        }
        /* Hide arrows in Chrome, Safari, Edge */
        .item-controls input[type="number"]::-webkit-outer-spin-button,
        .item-controls input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .item-card.checked {
            opacity: 0.7; /* Dim checked items */
            background-color: #f0fdf4; /* Light green for checked items */
            border-color: #86efac; /* Green border for checked items */
        }
        /* Part A - éœ€æ±‚8: Item card colors/borders */
        /* If not checked and no link, apply specific light gray/red */
        .item-card.no-link:not(.checked) {
            background-color: #f9fafb; /* æ·ºç™½ç° */
            border-color: #fca5a5; /* æ·¡ç´…è‰² */
            border-width: 1px; /* Ensure thin border */
        }
        /* If not checked and has link, apply specific white/blue */
        .item-card.has-link:not(.checked) {
            background-color: #ffffff; /* Default white for clarity */
            border-color: #63b3ed; /* A default blue for links when not checked */
            border-width: 3px; /* Ensure thick border */
        }
        /* Checked state overrides all */
        .item-card.checked {
            opacity: 1; /* Full visibility for checked items */
            background-color: #f0fdf4; /* Light green */
            border-color: #34d399; /* Deeper green */
            border-width: 3px; /* Ensure thick border when checked */
        }


        /* Category Summary Cards */
        .category-summary-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        .category-summary-card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 1.25rem;
            position: relative;
            border-left: 5px solid; /* For category color */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .category-summary-card .emoji {
            font-size: 2rem;
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            opacity: 0.7;
        }
        .category-summary-card h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
            padding-left: 2.5rem; /* Space for emoji */
        }
        .category-summary-card .total-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ef4444;
            text-align: right;
            margin-top: 0.75rem;
        }
        .category-summary-card.category-æ¿¾æ°´èˆ‡å„²æ°´ { border-color: #3b82f6; } /* blue-500 */
        .category-summary-card.category-é•·æ•ˆæœŸç³§é£Ÿ { border-color: #f59e0b; } /* amber-500 */
        .category-summary-card.category-è¡›ç”Ÿèˆ‡é†«ç™‚ { border-color: #ef4444; } /* red-500 */
        .category-summary-card.category-ä¿æš–èˆ‡è¡£ { border-color: #10b981; } /* emerald-500 */
        .category-summary-card.category-èƒ½æºèˆ‡ç‡ƒæ–™ { border-color: #f97316; } /* orange-500 */
        .category-summary-card.category-é€šè¨Š { border-color: #0ea5e9; } /* sky-500 */
        .category-summary-card.category-é˜²ç«é€ƒç”Ÿ { border-color: #dc2626; } /* red-600 */
        .category-summary-card.category-åŸºç¤ç¶œåˆ { border-color: #6b7280; } /* gray-500 */
        .category-summary-card.category-é¤å…· { border-color: #4b5563; } /* gray-700 */
        .category-summary-card.category-æœå°‹ä¸­ { border-color: #9ca3af; } /* gray-400 */

        /* Floating action buttons container */
        .float-buttons {
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px; /* Space between buttons */
            align-items: center; /* Center items horizontally */
        }

        .float-button {
            border: none;
            outline: none;
            background-color: #4f46e5; /* Purple background */
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 50%; /* Circular shape */
            font-size: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, transform 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 50px; /* Fixed width for circular button */
            height: 50px; /* Fixed height for circular button */
        }

        .float-button:hover {
            background-color: #6366f1;
            transform: translateY(-2px);
        }

        .float-button-label {
            color: #4f46e5; /* Text color matching button */
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
            width: 60px; /* Ensure label fits below button */
        }

        /* Chart container styles */
        .chart-container {
            width: 100%;
            max-width: 600px; /* Max width for the chart */
            margin: 2rem auto; /* Center the chart */
            padding: 1rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="antialiased">
    <div class="container">
        <!-- Header Section -->
        <header class="py-8 text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight mb-4 rounded-lg p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg">
                âœ¨ SP04ã€ŠSpreadsheet Wars Special Piece IVï¼šæˆ‘ä¸æƒ³ç­‰é£›æ©ŸçœŸçš„ä¸‹å¢œæ™‚ï¼Œæ‰é–‹å§‹å»æ¶é™è½å‚˜ï¼ã€‹
            </h1>
            <p class="text-xl md:text-2xl text-gray-700 font-medium mb-8">
                å°ç£æ­£è™•æ–¼å¹³è¡Œæ™‚ç©ºçš„åˆ†æ­§é»ã€‚å°±åƒä¸€éƒ¨å¤šé‡å®‡å®™é›»å½±ï¼Œç¾åœ¨çš„ä¸€å¿µé¸æ“‡ï¼Œå°‡é–‹å•Ÿæœªä¾†æˆªç„¶ä¸åŒçš„ä¸–ç•Œç·šã€‚
            </p>
        </header>

        <!-- Progress Summary Section -->
        <section class="card mb-8 p-6 bg-blue-50 border-l-4 border-blue-400">
            <h2 class="text-2xl font-semibold text-blue-800 mb-4">æˆ‘çš„å®¶åº­é˜²ç½åŒ…é€²åº¦</h2>
            <p class="text-lg text-blue-700">
                æ‚¨å·²å‹¾é¸ <span id="checkedItemsCount" class="font-bold text-3xl">0</span> å€‹å“é …ï¼Œç¸½è¨ˆ <span id="totalItemsCount" class="font-bold text-3xl">0</span> å€‹ã€‚
            </p>
            <p class="text-lg text-blue-700 mt-2">
                å·²å‹¾é¸å“é …é ä¼°ç¸½é‡‘é¡ï¼š<span id="totalEstimatedCost" class="font-bold text-3xl text-red-600">NT$ 0</span>
            </p>
            <p class="text-sm text-blue-600 mt-2">
                ç¹¼çºŒåŠªåŠ›ï¼Œä¸€èµ·è®“æ‚¨çš„å®¶åº­æ›´å®‰å…¨ï¼
            </p>
        </section>

        <!-- Quantity Calculation Section (Part C - éœ€æ±‚1) -->
        <section class="card mb-8 p-6 bg-purple-50 border-l-4 border-purple-400">
            <h2 class="text-2xl font-semibold text-purple-800 mb-4">ä¾äººæ•¸èˆ‡å¤©æ•¸é ä¼°æ•¸é‡</h2>
            <p class="text-sm text-purple-700 mb-4">
                è«‹è¼¸å…¥å®¶åº­æˆå“¡äººæ•¸èˆ‡é ä¼°å„²å‚™å¤©æ•¸ï¼Œç³»çµ±å°‡è‡ªå‹•è¨ˆç®—ã€Œæ¿¾æ°´èˆ‡å„²æ°´ã€åŠã€Œé•·æ•ˆæœŸç³§é£Ÿã€çš„å»ºè­°æ•¸é‡ã€‚
                <br>
                <span class="font-bold">æ³¨æ„ï¼š</span>å…¶ä»–é¡åˆ¥å“é …æ•¸é‡éœ€æ‰‹å‹•èª¿æ•´ã€‚
            </p>
            <div class="flex flex-wrap items-center gap-4 mb-4">
                <div class="flex flex-col">
                    <label for="adults" class="text-gray-700 font-medium mb-1"><i class="fas fa-user mr-2"></i>å¤§äººäººæ•¸:</label>
                    <input type="number" id="adults" value="2" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div class="flex flex-col">
                    <label for="children" class="text-gray-700 font-medium mb-1"><i class="fas fa-child mr-2"></i>å°å­©äººæ•¸:</label>
                    <input type="number" id="children" value="0" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div class="flex flex-col">
                    <label for="days" class="text-gray-700 font-medium mb-1"><i class="fas fa-calendar-alt mr-2"></i>é ä¼°å„²å‚™å¤©æ•¸:</label>
                    <input type="number" id="days" value="7" min="1" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <button id="calculateQuantitiesBtn" class="mt-auto px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                    è¨ˆç®—å»ºè­°æ•¸é‡
                </button>
                <button id="checkAllBtn" class="mt-auto px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                    å¿«é€Ÿå…¨éƒ¨å‹¾é¸
                </button>
                <button id="uncheckAllBtn" class="mt-auto px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                    å¿«é€Ÿå…¨éƒ¨å–æ¶ˆ
                </button>
            </div>
            <p class="text-xs text-gray-500">
                é è¨­ï¼šæ¯äººæ¯å¤©æ°´ 3 å…¬å‡ï¼Œæ¯äººæ¯å¤©ç³§é£Ÿ 2 ä»½ã€‚
            </p>
        </section>

        <!-- Category Summary Section -->
        <section class="card mb-8">
            <h2 class="section-title">ç¸½é‡‘é¡èˆ‡å„é¡åˆ¥é‡‘é¡å°è¨ˆ</h2>
            <div id="category-summary-container" class="category-summary-list">
                <!-- Category summary cards will be generated here -->
            </div>
            <!-- Pie Chart for Category Totals -->
            <div class="chart-container">
                <canvas id="categoryPieChart"></canvas>
            </div>
        </section>

        <!-- Introduction Section -->
        <section class="card">
            <h2 class="section-title">å¼•è¨€</h2>
            <blockquote class="text-lg italic text-gray-600 mb-6 border-l-4 border-blue-500 pl-4">
                ã€Œåœ¨æˆ°çˆ­èˆ‡å±ˆè¾±é¢å‰ï¼Œä½ é¸æ“‡äº†å±ˆè¾±ï¼å¯æ˜¯ï¼Œå±ˆè¾±éå¾Œï¼Œä½ ä»å¾—é¢å°æˆ°çˆ­ï¼ã€
                <footer class="mt-2 text-sm text-gray-500">â€” å·²æ•…è‹±åœ‹é¦–ç›¸ï¼Œæº«æ–¯é “Â·ä¸˜å‰çˆ¾(1938)</footer>
            </blockquote>
            <p class="mb-4">
                é€™ç¯‡æ–‡ç« æ¢è¨äº†å¦‚æœä½ çŸ¥é“ä¸€å€‹é¸æ“‡å¯èƒ½å°è‡´å…©æ¢å®Œå…¨ä¸åŒçš„ä¸–ç•Œç·šï¼Œä½ æœƒé¸æ“‡ææ—©æº–å‚™ï¼Œé‚„æ˜¯è¢–æ‰‹æ—è§€ç¹¼çºŒç­‰å¾…ï¼Ÿ
            </p>
            <p class="mb-4">
                ä½œè€…è¿‘å…©å€‹æœˆé€²è¡Œäº†ä¸€é …ã€Œå¸Œæœ›æ°¸é ç”¨ä¸åˆ°ï¼Œä½†ä¸€æ—¦éœ€è¦å°±é—œä¹ç”Ÿæ­»ã€çš„ä»»å‹™ï¼šæº–å‚™å®¶åº­ç½é›£åŒ…ã€‚
            </p>
            <p class="mb-4">
                æº–å‚™é€™äº›çœŸçš„å¾ˆè€—ç¥ã€è€—éŒ¢ä¹Ÿè€—æ™‚é–“ï¼Œå¯èƒ½å¾—èŠ±è²»ä¸€æ•´å€‹æœˆçš„è–ªæ°´ã€‚ä½†æ›ä¾†çš„ï¼Œæ˜¯å…§å¿ƒçš„å®‰å®šæ„Ÿï¼Œé‚„æœ‰ç•¶æ„å¤–ç™¼ç”Ÿæ™‚ï¼Œä¸è‡³æ–¼åªèƒ½æ‰‹å¿™è…³äº‚æ¶ç‰©è³‡ï¼Œé¿å…ç­‰åˆ¥äººå‘Šè¨´ä½ æ€éº¼è¾¦çš„é‚£ç¨®è¢«å‹•æ„Ÿã€‚
            </p>
            <p class="mb-4">
                é¢±é¢¨ã€åœ°éœ‡ã€ç–«æƒ…ï¼Œå¤§å®¶éƒ½æœƒåšä¸€é»æº–å‚™ï¼Œä½†é¢å°æ›´æ¥µç«¯ä¸”è¤‡åˆå¼çš„é¢¨éšªï¼Œåè€Œæœƒå› ç‚ºå¤ªæ²‰é‡ï¼Œè€Œé¸æ“‡å£“æŠ‘èˆ‡å¿½ç•¥ä¸å®‰ã€‚ä½†äº‹å¯¦ä¸Šï¼Œæˆ°çˆ­å°±æ˜¯æœ€é«˜å¼·åº¦çš„ç¶œåˆç½é›£ï¼šæ°´é›»ä¸­æ–·ã€ç‰©è³‡çŸ­ç¼ºã€è³‡è¨Šå°é–ã€ç¶²è·¯ç™±ç˜“ã€é†«ç™‚ç™±ç˜“ã€äº¤é€šåœæ“ºã€è²¡ç”¢å–ªå¤±ã€äººèº«å¨è„…ï¼Œä»¥åŠå„ç¨®å‹æ…‹çš„æš´åŠ›èˆ‡ä¾µå®³ã€‚ä¸ç®¡ä½ çš„èº«åˆ†èˆ‡åƒ¹å€¼è§€ï¼Œé€™äº›ç½é›£éƒ½ä¸æœƒå…ˆæ•²é–€è©¢å•ä½ çš„åŒæ„ï¼šã€ŒHey, bro! Do you want a battle?ã€
            </p>
            <p>
                æˆ‘å¸Œæœ›è‡ªå·±èƒ½åšæ±ºå®šï¼Œè€Œä¸æ˜¯åœ¨åˆ¥äººæ±ºå®šå¾Œè¢«è¿«æ¥å—çµæœã€‚ç”Ÿå­˜èˆ‡å°Šåš´ï¼Œä¹Ÿæ‡‰è©²æ˜¯æˆ‘å€‘ä¸»å‹•åšå‡ºçš„é¸æ“‡ï¼Œè€Œä¸æ˜¯å¯„è¨—æ•µäººçš„ä»æ…ˆèˆ‡å–„æ„ï¼Œæˆ–è®“ä»–äººæ›¿æˆ‘å€‘è¦åŠƒã€‚
            </p>
        </section>

        <!-- Disaster Kit Contents Section -->
        <section class="card">
            <h2 class="section-title">é˜²ç½åŒ…å…§å®¹æ¸…å–®</h2>
            <p class="mb-6 text-center text-gray-600">
                ã€Œæº–å‚™ä¸å®Œå…¨ï¼Œä¹Ÿå‹éå®Œå…¨ä¸æº–å‚™ã€â€” é€™æ˜¯ä¸€ä»½æˆ‘å€‘ç‚ºå®¶åº­æº–å‚™çš„é˜²ç½åŒ…æ¸…å–®ï¼Œå¸Œæœ›èƒ½ç‚ºæ‚¨æä¾›ä¸€äº›åƒè€ƒã€‚
            </p>

            <h3 class="subsection-title">æ ¸å¿ƒå¿…éœ€å“</h3>
            <ul class="list-disc list-inside text-gray-700 mb-6 space-y-2">
                <li>é£²æ°´</li>
                <li>ç³§é£Ÿ</li>
                <li>é†«ç™‚ç”¨å“</li>
                <li>è¡›ç”Ÿç”¨å“</li>
                <li>èƒ½æºç‡ƒæ–™</li>
                <li>é€šè¨Šè¨­å‚™</li>
                <li>é¿é›£åœ°é»è¦åŠƒ</li>
            </ul>

            <h3 class="subsection-title">è©³ç´°å“é …èˆ‡é ä¼°é‡‘é¡ (åƒè€ƒ)</h3>
            <div id="disaster-kit-items-container" class="item-list">
                <!-- Items will be dynamically generated here by JavaScript -->
            </div>
            <p class="mt-6 text-center text-gray-600 italic">
                â€» æ¨è–¦è³¼è²·ä¾†æºå°‡åœ¨å¾ŒçºŒæ•´ç†æ›´å®Œæ•´å¾Œé™„ä¸Šã€‚
            </p>
        </section>

        <!-- Conclusion Section -->
        <section class="card">
            <h2 class="section-title">çµèª</h2>
            <p class="mb-4">
                å¦‚æœä¹Ÿæ›¾ç¶“è¦ºå¾—ç„¦æ…®ï¼Œä¸å¦¨è²¼è¿‘ã€Œç¬¬ä¸€æ€§åŸç†ã€ä¾†æ€è€ƒï¼š
            </p>
            <ul class="list-disc list-inside text-gray-700 mb-6 space-y-2">
                <li>ä½ çœŸæ­£çš„ç„¦æ…®èˆ‡æ“”å¿ƒæ˜¯ä»€éº¼ï¼Ÿï¼ˆç”Ÿå‘½è²¡ç”¢ï¼Ÿç”Ÿæ´»æ–¹å¼ï¼Ÿä¸‹ä¸€ä»£ï¼Ÿâ€¦ï¼‰</li>
                <li>è®“ä½ ä¸å®‰çš„å› ç´ ä¾†è‡ªå“ªè£¡ï¼Ÿï¼ˆäººï¼Ÿäº‹ï¼Ÿç‰©ï¼Ÿâ€¦ï¼‰</li>
                <li>ä½ ç¾åœ¨èƒ½åšçš„æœ‰ä»€éº¼ï¼Ÿï¼ˆå¼·åŒ–å€‹é«”éŸŒæ€§ï¼Ÿå®¶åº­æº–å‚™ï¼Ÿç¥ˆç¦±ï¼Ÿâ€¦ï¼‰</li>
            </ul>
            <p class="mb-4">
                é€™äº›å•é¡Œçš„ç­”æ¡ˆï¼Œæ¯å€‹äººæ‡‰è©²ä¸æœƒä¸€æ¨£ï¼Œä½†èƒ½å¹«åŠ©æˆ‘å€‘é‡æ¸…â”€â”€ä»€éº¼æ˜¯è®“ä½ ç„¦æ…®çš„æºé ­ï¼Ÿä»€éº¼è¡Œå‹•èƒ½è®“ä½ æ„Ÿåˆ°å®‰å¿ƒï¼Ÿ
            </p>
            <p class="mb-6 text-center text-lg font-semibold text-blue-700">
                ã€Œç•¶é£›æ©Ÿé–‹å§‹ä¸‹å¢œæ™‚ï¼Œä½ è¦ç­‰åˆ¥äººéçµ¦ä½ é™è½å‚˜ï¼Ÿé‚„æ˜¯ç¾åœ¨ï¼Œå°±ç‚ºè‡ªå·±æº–å‚™ä¸€æŠŠï¼Ÿã€
            </p>
            <p class="mb-4 text-center">
                ç«™å‡ºä¾†ï¼Œå°±æ˜¯é¸æ“‡ä¸ä¾è³´åˆ¥äººçš„å–„æ„æ›¿ä½ æ±ºå®šæœªä¾†ï¼
            </p>
            <p class="footer-text">
                â”€â”€SpreadSheetWars SP04ï¼Œèˆªè¡Œæ—¥èªŒç´€éŒ„å®Œæˆã€‚â”€â”€
            </p>
            <p class="footer-text mt-4">
                ğŸ” è‹¥æ‚¨è¦ºå¾—é€™ç¯‡å…§å®¹å°æ‚¨æˆ–æ‚¨çš„å®¶äººæœ‰æ‰€å¹«åŠ©ï¼Œæ­¡è¿åˆ†äº«ã€è½‰è²¼æˆ–é‡è£½ã€‚
            </p>
            <p class="footer-text">
                ğŸ§© åœ‹å®¶çš„éŸŒæ€§ï¼Œå¾æ¯å€‹å®¶åº­çš„æº–å‚™é–‹å§‹ã€‚
            </p>
            <p class="footer-text">
                âœ¨ é¡˜æ°‘ä¸»èˆ‡ç¹æ¦®èˆ‡æˆ‘å€‘åŒåœ¨â”€â”€ç›´åˆ°æ°¸é ï¼
            </p>
        </section>

        <footer class="py-8 text-center text-gray-500 text-sm">
            <p>&copy; 2025 Spreadsheet Wars. All rights reserved.</p>
            <p>#ç½é›£æº–å‚™ #é˜²è¡›æ„è­˜ #ç¬¬ä¸€æ€§åŸç† #å®¶åº­è²¬ä»» #SpreadSheetWars</p>
            <p>#DisasterPreparedness #DefenseAwareness #FirstPrinciples #FamilyResponsibility #SpreadSheetWars</p>
        </footer>
    </div>

    <!-- Floating action buttons container -->
    <div class="float-buttons">
        <!-- Generate PDF Button (Part C - éœ€æ±‚5) -->
        <div class="flex flex-col items-center">
            <button id="generatePdfBtn" class="float-button" title="ç”¢ç”ŸPDF">
                <i class="fas fa-file-pdf"></i>
            </button>
            <span class="float-button-label">ç”¢ç”ŸPDF</span>
        </div>

        <!-- Generate Log File Button (Part C - éœ€æ±‚4) -->
        <div class="flex flex-col items-center">
            <button id="generateLogBtn" class="float-button" title="ç”¢ç”Ÿç´€éŒ„æª”">
                <i class="fas fa-save"></i>
            </button>
            <span class="float-button-label">ç”¢ç”Ÿç´€éŒ„æª”</span>
        </div>

        <!-- Load Log File Button (Part C - éœ€æ±‚4 - Load) -->
        <div class="flex flex-col items-center">
            <button id="loadLogBtn" class="float-button" title="è¼‰å…¥ç´€éŒ„æª”">
                <i class="fas fa-upload"></i>
            </button>
            <span class="float-button-label">è¼‰å…¥ç´€éŒ„æª”</span>
            <input type="file" id="loadLogInput" accept=".json" style="display: none;">
        </div>

        <!-- Scroll to Top Button (Part C - éœ€æ±‚3) -->
        <div class="flex flex-col items-center">
            <button id="scrollToTopBtn" class="float-button" title="å›åˆ°é ‚ç«¯">
                <i class="fas fa-arrow-up"></i>
            </button>
            <span class="float-button-label">å›åˆ°é ‚ç«¯</span>
        </div>
    </div>

    <script>
        // Define the disaster kit items data from the provided CSV
        // å°‡ CSV æ•¸æ“šè§£æç‚º JavaScript ç‰©ä»¶é™£åˆ—
        const csvData = `,"è³¼è²·
é †åº","è¨˜å¸³
æ¶ˆè²»æ—¥",å·²è³¼è²·,å·²æ”¶ç´,å„ªå…ˆé †åº,åˆ†é¡,è³¼è²·é€šè·¯_å•†å®¶ ,å•†å“åç¨±,ä¿å­˜å¹´é™,å‚™è¨»,æ•¸é‡,å–®ä½,"æŠ˜æ‰£èˆ‡æŠ˜æŠµå¾Œé‡‘é¡
(éƒ¨åˆ†æœ‰å«é‹)","å¹³å‡å–®åƒ¹",è³¼è²·é€£çµ,ç›®å‰ç¸½èŠ±è²»
,6,2025/6/20,V,V,1,æ¿¾æ°´èˆ‡å„²æ°´,è¦çš®,æ—¥æœ¬MochiGoo PETæè³ªå¯æŠ˜ç–Šæ°´å£ºè¢‹(8å…¬å‡å®¹é‡),ç„¡ä¿å­˜æœŸé™,PETæè³ªæ°´æº«å»ºè­°ä¸è¶…é60æ”æ°åº¦,8,å€‹,"1,172 ",147 ,https://tw.shp.ee/5nuoRdJ,"55,436 "
,18,2025/7/5,V,V,1,æ¿¾æ°´èˆ‡å„²æ°´,è¦çš®,ç¾åœ‹KATADYN MICROPUR MP1éæ¿¾éš±å­¢èŸ²è—¥éŒ (ä¸€ç›’30é¡†),5å¹´,æ¯ç›’30é¡†ï¼Œæ¯é¡†å¯è™•ç†1å…¬å‡æ±™æ°´ï¼Œéœ€è¦éœç½®1~4å°æ™‚,2,ç›’,"1,275 ",638 ,https://tw.shp.ee/jd5oSQE
,13,2025/7/1,V,V,1,æ¿¾æ°´èˆ‡å„²æ°´,è¦çš®_åŸå¸‚ç¶ æ´²,ç¾åœ‹LifeStrawPeakç”Ÿå‘½å¸ç®¡å¯éæ¿¾4000å…¬å‡(å¹³è£ç‰ˆå¤–åŒ…è£¸è£),ç„¡æœŸé™,å“ç‰Œä¿¡è­½é«˜ï½œéæ¿¾æ•ˆæœåœ¨éæ´²ç­‰åœ°å€ç¶“éå¤§é‡é©—è­‰,3,éš»,"2,430 ",810 ,https://tw.shp.ee/KceBiia
,23,2025/7/6,V,V,1,æ¿¾æ°´èˆ‡å„²æ°´,è¦çš®,ç¾åœ‹WaterBOBæµ´ç¼¸è»Ÿæ€§å„²æ°´è¢‹,ç„¡æœŸé™,æœ€å¤§å¯å„²å­˜ç´„100åŠ ä¾–=378å…¬å‡,1,è¢‹,2200,2200,https://tw.shp.ee/FfHYWbi
,19,2025/7/5,V,V,5,èƒ½æºèˆ‡ç‡ƒæ–™,è¦çš®,ç¾åœ‹CampMaidå›ºé«”ç‡ƒæ–™å¡Š(12é¡†è£) x 5 + éˆ¦åˆé‡‘æ¹¯åŒ™,ç„¡æœŸé™,æ¨è–¦æ­é…å¯æ”¾ç½®å›ºé«”ç‡ƒæ–™å¡Šçš„ç¾åœ‹Vargoéˆ¦é‡‘å±¬å°çˆå…·,60,é¡†,744 ,12 ,https://tw.shp.ee/qVHMQgy
,23,2025/7/6,V,V,5,èƒ½æºèˆ‡ç‡ƒæ–™,è¦çš®,ç¾åœ‹é›»å¼§é»ç«å™¨å…¼é˜²æ°´LEDæ‰‹é›»ç­’,ç„¡æœŸé™,mini-USBå……é›»å£,2,éš»,"1,580 ",790 ,https://tw.shp.ee/qVHMQgy
,5,2025/6/15,V,V,5,èƒ½æºèˆ‡ç‡ƒæ–™,è¦çš®_é›»æ± å“¥,æ—¥æœ¬Panasonic EVOLTAé•·æ•ˆé¹¼æ€§é›»æ± ,10å¹´,åŒ…å«ï¼š3è™ŸAAèˆ‡4è™ŸAAAé›»æ± ,1,æ‰¹,807 ,807 ,https://tw.shp.ee/vbbukfA
,30,2025/12/31,,,5,èƒ½æºèˆ‡ç‡ƒæ–™,æœå°‹ä¸­,"[æœå°‹ä¸­]å–®æ™¶çŸ½å¤ªé™½èƒ½å……é›»æ¿",ç„¡æœŸé™,ç›®å‰æœå°‹ä¸­æ¯”è¼ƒä¸­â€¦å°‡ä»¥æ—¥æœ¬ã€å°ç£ã€æ­ç¾åœ‹å“ç‰Œç‚ºç›®æ¨™ï¼Œç‚ºäº†å®‰å…¨æ€§å°‡é¿é–‹ä¸­åœ‹å“ç‰Œèˆ‡è£½å“,1,ç‰‡,,0 ,--
,30,2025/12/31,,,5,èƒ½æºèˆ‡ç‡ƒæ–™,æœå°‹ä¸­,"[æœå°‹ä¸­]ç£·é…¸éµé‹°ç§»å‹•é›»ç«™(LiFePO 4)",ç„¡æœŸé™,ç›®å‰æœå°‹ä¸­æ¯”è¼ƒä¸­â€¦å°‡ä»¥æ—¥æœ¬ã€å°ç£ã€æ­ç¾åœ‹å“ç‰Œç‚ºç›®æ¨™ï¼Œç‚ºäº†å®‰å…¨æ€§å°‡é¿é–‹ä¸­åœ‹å“ç‰Œèˆ‡è£½å“,1,åº§,,0 ,--
,2,2025/5/1,V,V,2,é•·æ•ˆæœŸç³§é£Ÿ,è¦çš®,ç¾åœ‹SurvivalTabç”Ÿå­˜å£åš¼ç‰‡é¦™è‰å£å‘³(ä¸€è¢‹24é¡†),25å¹´,ä¸€è¢‹24é¡†è£ï¼Œä¾›æ‡‰2æ—¥æœ€ä½éœ€æ±‚ï½œå¯¦æ¸¬é¦™è‰å£å‘³åƒèµ·ä¾†åƒéº¥èŠ½(å¥½åƒ),2,è¢‹,1122,561,https://tw.shp.ee/W1LnMkN
,3,2025/7/6,V,V,2,é•·æ•ˆæœŸç³§é£Ÿ,è¦çš®,ç¾åœ‹SurvivalTabç”Ÿå­˜å£åš¼ç‰‡é¦™è‰å£å‘³(ä¸€è¢‹24é¡†),25å¹´,ä¸€è¢‹24é¡†è£ï¼Œä¾›æ‡‰2æ—¥æœ€ä½éœ€æ±‚ï½œå¯¦æ¸¬é¦™è‰å£å‘³åƒèµ·ä¾†åƒéº¥èŠ½(å¥½åƒ),3,è¢‹,1683,561,https://tw.shp.ee/W1LnMkN
,24,2025/7/6,V,V,2,é•·æ•ˆæœŸç³§é£Ÿ,è¦çš®,ç¾åœ‹NRG-5æˆ°å‚™å£ç³§,20å¹´,å¾·åœ‹AmazonéŠ·å”®é‡æœ€é«˜çš„é˜²ç½å£ç³§ï½œä½éæ•åŸæ–™å’Œé«˜èƒ½é‡,1,éš»,890 ,890 ,https://tw.shp.ee/FfHYWbi
,1,2025/5/1,V,V,8,åŸºç¤ç¶œåˆ,é»‘ç†Šå­¸é™¢,é¿é›£é˜²ç½ç”¨å“(åŒ…å«ï¼šæ­¢è¡€å¸¶ã€é˜²èº«å™´åŠ‘å…¼ç ´çª—å™¨ã€å¯æ‘ºç–Šæ°´å£ºå«æ¿¾å˜´ã€EDCæ¯æ—¥æ”œå¸¶éš¨èº«å´èƒŒåŒ…...),è»Ÿå¼æ°´å£º2å¹´,æ­¢è¡€å¸¶x3ã€å¯å½æ›²æ°´å£ºx2ã€æ¿¾å˜´å¯éæ¿¾1000å…¬å‡x5ã€é˜²èº«å™´åŠ‘å…¼ç ´çª—å™¨x2,1,æ‰¹,14530,14530,https://kuma-academy.org/
,1,2025/5/1,V,V,8,åŸºç¤ç¶œåˆ,å˜–å˜–_äº¬å“æº,é¿é›£é˜²ç½ç”¨å“(åŒ…å«ï¼šå¤§å‹æˆ°è¡“é˜²ç½åŒ…ã€POW-R1ç·Šæ€¥ä¹¾ç³§ã€å¤ªé™½èƒ½æ”¶éŸ³æ©Ÿã€åŸºæœ¬å“é …è©³é–±ç¶²ç«™â€¦),POW-R1ç·Šæ€¥ä¹¾ç³§20å¹´,åŸºæœ¬å“é …è©³é–±ç¶²ç«™,1,æ‰¹,5589,5589,https://jingpinyuan.tw/product.php
,10,2025/6/30,V,V,3,è¡›ç”Ÿèˆ‡é†«ç™‚,è¦çš®,å¸¸ç”¨æŠ—ç”Ÿç´ è»Ÿè†(ä¸€ç›’30å…‹),15å¹´,ä½¿ç”¨æ–¼å‚·å£åŠçš®è†šæ„ŸæŸ“ï¼Œè»Ÿç®¡è¨­è¨ˆæ˜“æ–¼æ”œå¸¶åŠä½¿ç”¨,1,æ¢,975 ,975 ,https://tw.shp.ee/qVHMQgy
,11,2025/7/1,V,V,3,è¡›ç”Ÿèˆ‡é†«ç™‚,è¦çš®,æ—¥æœ¬ADiSé˜²æ°´é›¨æŠ«+ç¡è¢‹,ç„¡æœŸé™,æ—¥æœ¬ADiSé˜²æ°´é›¨æŠ«+ç¡è¢‹ï¼Œè¼•é‡é˜²æ°´ï¼Œå¯æä¾›ä¿æš–å’Œé˜²æ½®åŠŸèƒ½ï¼Œé©åˆç·Šæ€¥é¿é›£æ™‚ä½¿ç”¨,1,å€‹,180 ,180 ,https://tw.shp.ee/qVHMQgy
,14,2025/7/2,V,V,3,è¡›ç”Ÿèˆ‡é†«ç™‚,è¦çš®,æä¸€è—¥å“,ç„¡æœŸé™,ç¶œåˆè—¥å“ï¼Œæ‡‰å°å¸¸è¦‹ç–¾ç—…å’Œè¼•å‚·ï¼Œæ–¹ä¾¿æ”œå¸¶,1,æ‰¹,883 ,883 ,--
,15,2025/7/2,V,V,3,è¡›ç”Ÿèˆ‡é†«ç™‚,è¦çš®,ç¾æ³°å¾·è—¥å“,ç„¡æœŸé™,ç¶œåˆè—¥å“ï¼Œæ‡‰å°å¸¸è¦‹ç–¾ç—…å’Œè¼•å‚·ï¼Œæ–¹ä¾¿æ”œå¸¶,1,æ‰¹,497 ,497 ,--
,16,2025/7/2,V,V,3,è¡›ç”Ÿèˆ‡é†«ç™‚,è¦çš®,ç°¡æ˜“å°¿è¢‹(2å€‹),ç„¡æœŸé™,ç°¡æ˜“å°¿è¢‹ï¼Œé©ç”¨æ–¼ç·Šæ€¥æƒ…æ³ä¸‹çš„å€‹äººè¡›ç”Ÿéœ€æ±‚ï¼Œæ–¹ä¾¿è™•ç†æ’æ³„ç‰©,2,åŒ…,157 ,79 ,--
,4,2025/6/1,V,V,7,é˜²ç«é€ƒç”Ÿ,è¦çš®,å°ç£å¯§å¨é˜²ç…™é ­ç½©,5å¹´,å¤§ç´„è€ç†±500åº¦,3,ç‰‡,1100,1100,https://tw.shp.ee/FfHYWbi
,25,2025/7/6,V,V,6,é€šè¨Š,è¦çš®,ADi AV-03å…åŸ·ç…§å°è¬›æ©Ÿ2éš»ä¸€çµ„,ç„¡æœŸé™,å…åŸ·ç…§å°è¬›æ©Ÿï¼Œæ–¹ä¾¿ç·Šæ€¥é€šè¨Šï¼Œå…©éš»ä¸€çµ„,1,çµ„,2514,2514,https://tw.shp.ee/qVHMQgy
,26,2025/7/6,V,V,9,é¤å…·,è¦çš®,ä¸­åœ‹Kinshiéˆ¦é‡‘å±¬ç­·å­(560)+å‰åŒ™(465)-æŠ˜æ‰£(263),ç„¡æœŸé™,è¼•é‡è€ç”¨ï¼Œæˆ¶å¤–ç”¨é¤å·¥å…·ï¼Œæ–¹ä¾¿æ”œå¸¶,1,çµ„,762 ,762 ,https://tw.shp.ee/qVHMQgy
`;

        // Function to parse CSV data
        function parseCSV(csvString) {
            const lines = csvString.trim().split('\n');
            // BugFix: The CSV data now starts with the header line, so slice(1) to skip it.
            const dataLines = lines.slice(1);
            const items = [];

            dataLines.forEach(line => {
                // Skip empty lines that might result from trailing newlines or malformed CSV
                if (!line.trim()) {
                    return;
                }

                // Split by comma, but handle potential commas within quoted strings
                // A simple split(',') is often insufficient for robust CSV parsing if fields contain commas.
                // For this specific CSV, it seems simple split will work for the relevant columns if we are careful.
                // Let's use a regex to split by comma, but not if it's inside double quotes.
                // However, given the current CSV structure, direct splitting and trimming parts is safer.
                const parts = line.split(',');

                // Clean and parse data based on CSV column index
                // Note: CSV is 0-indexed, and there's an empty leading column.
                // So, "è³¼è²·é †åº" is index 1, "åˆ†é¡" is index 6, "å•†å“åç¨±" is index 8, etc.
                // Added checks (parts[index] || '') to prevent 'undefined' errors
                const rowIndexNumber = parseInt((parts[1] || '').trim(), 10); // Cæ¬„ä½: è³¼è²·é †åº
                const category = (parts[6] || '').trim(); // Fæ¬„ä½: åˆ†é¡
                const itemName = (parts[8] || '').trim(); // Kæ¬„ä½: å•†å“åç¨±
                const shelfLife = (parts[10] || '').trim(); // Læ¬„ä½: ä¿å­˜å¹´é™
                const notes = (parts[11] || '').trim(); // Mæ¬„ä½: å‚™è¨»
                // For quantity, ensure it's a number, default to 1 if empty or invalid
                const quantityInSheet = parseInt((parts[12] || '1').trim(), 10) || 1; // Næ¬„ä½: æ•¸é‡
                // For unitPrice, ensure it's a number, clean non-numeric characters (commas, spaces)
                const unitPrice = parseFloat((parts[14] || '0').replace(/[^0-9.-]+/g, "")); // Qæ¬„ä½: å¹³å‡å–®åƒ¹
                const purchaseLink = (parts[16] || '').trim(); // Ræ¬„ä½: è³¼è²·é€£çµ

                // Skip items with invalid price or name
                if (isNaN(unitPrice) || !itemName) {
                    return;
                }

                items.push({
                    id: `item-${rowIndexNumber}-${items.length}`, // Unique ID for each item
                    rowIndexNumber: rowIndexNumber,
                    name: itemName,
                    price: unitPrice,
                    category: category,
                    shelfLife: shelfLife,
                    notes: notes,
                    link: purchaseLink,
                    initialQuantity: quantityInSheet // Store initial quantity from sheet
                    // unitConversionFactor will be added here later
                });
            });

            // Sort items by rowIndexNumber (Part A - éœ€æ±‚3 & Part C - éœ€æ±‚4)
            items.sort((a, b) => a.rowIndexNumber - b.rowIndexNumber);
            return items;
        }

        const disasterKitItems = parseCSV(csvData);

        // Category importance and emojis (Part B - éœ€æ±‚3 & Part D - éœ€æ±‚3)
        const categoryImportance = {
            "æ¿¾æ°´èˆ‡å„²æ°´": 1,
            "é•·æ•ˆæœŸç³§é£Ÿ": 2,
            "è¡›ç”Ÿèˆ‡é†«ç™‚": 3,
            "ä¿æš–èˆ‡è¡£": 4,
            "èƒ½æºèˆ‡ç‡ƒæ–™": 5,
            "é€šè¨Š": 6,
            "é˜²ç«é€ƒç”Ÿ": 7,
            "åŸºç¤ç¶œåˆ": 8,
            "é¤å…·": 9,
            "æœå°‹ä¸­": 10 // Items still being researched
        };

        const categoryEmojis = {
            "æ¿¾æ°´èˆ‡å„²æ°´": "ğŸ’§",
            "é•·æ•ˆæœŸç³§é£Ÿ": "ğŸ¥«",
            "è¡›ç”Ÿèˆ‡é†«ç™‚": "ğŸ©¹",
            "ä¿æš–èˆ‡è¡£": "ğŸ§¥",
            "èƒ½æºèˆ‡ç‡ƒæ–™": "âš¡",
            "é€šè¨Š": "ğŸ“",
            "é˜²ç«é€ƒç”Ÿ": "ğŸ”¥",
            "åŸºç¤ç¶œåˆ": "ğŸ“¦",
            "é¤å…·": "ï¿½",
            "æœå°‹ä¸­": "ğŸ”"
        };


        // Function to get saved state from Local Storage
        function getSavedState() {
            try {
                const savedState = localStorage.getItem('disasterKitState');
                return savedState ? JSON.parse(savedState) : {};
            } catch (e) {
                console.error("Error loading state from Local Storage:", e);
                return {};
            }
        }

        // Function to save state to Local Storage
        function saveState(state) {
            try {
                localStorage.setItem('disasterKitState', JSON.stringify(state));
            } catch (e) {
                console.error("Error saving state to Local Storage:", e);
            }
        }

        // Initialize items with saved state or default values
        let currentItemsState = getSavedState();
        disasterKitItems.forEach(item => {
            if (currentItemsState[item.id]) {
                item.checked = currentItemsState[item.id].checked;
                item.quantity = currentItemsState[item.id].quantity;
            } else {
                item.checked = false; // Default to unchecked
                item.quantity = item.initialQuantity || 1; // Use initial quantity from sheet or default to 1
            }
        });

        // Function to render/re-render the item list
        function renderDisasterKitItems() {
            const container = document.getElementById('disaster-kit-items-container');
            container.innerHTML = ''; // Clear existing items

            disasterKitItems.forEach(item => {
                // Check if link exists and is not just "--" (Part A - éœ€æ±‚6 & Part C - éœ€æ±‚7)
                const isLink = item.link && item.link.length > 0 && item.link !== '--';
                const itemElement = document.createElement(isLink ? 'a' : 'div'); // Use <a> for links, <div> otherwise
                if (isLink) {
                    itemElement.href = item.link;
                    itemElement.target = '_blank'; // Open in new tab
                    itemElement.rel = 'noopener noreferrer'; // Security best practice for target="_blank"
                }

                itemElement.className = `item-card ${isLink ? 'has-link' : 'no-link'} category-${item.category} ${item.checked ? 'checked' : ''}`;
                itemElement.setAttribute('data-id', item.id); // Store item ID for easy lookup

                // Construct tooltip details (Part A - éœ€æ±‚5 & Part C - éœ€æ±‚6)
                let tooltipContent = `<ul>`;
                tooltipContent += `<li><strong>å•†å“åç¨±:</strong> ${item.name || 'N/A'}</li>`;
                tooltipContent += `<li><strong>ä¿å­˜å¹´é™: ç’°å¢ƒ:</strong> ${item.shelfLife || 'N/A'}</li>`; // Læ¬„ä½
                // Display "æš«æ™‚ç„¡è£œå……è³‡è¨Š" if notes is empty or "--" (Mæ¬„ä½)
                tooltipContent += `<li><strong>å‚™è¨»:</strong> ${item.notes && item.notes !== '--' ? item.notes : 'æš«æ™‚ç„¡è£œå……è³‡è¨Š'}</li>`;
                tooltipContent += `</ul>`;

                itemElement.innerHTML = `
                    <strong class="text-gray-900">${item.name}</strong> <!-- Part A - éœ€æ±‚1 & Part C - éœ€æ±‚2 -->
                    <div class="item-price-info">
                        <span class="item-price">NT$ ${(item.price * item.quantity).toLocaleString('zh-TW')}</span> <!-- Part A - éœ€æ±‚4 & Part C - éœ€æ±‚5 -->
                        <span class="shelf-life">${item.shelfLife || 'ç„¡æœŸé™'}</span> <!-- Part A - éœ€æ±‚2 & Part C - éœ€æ±‚3 -->
                    </div>
                    <div class="tooltip-details">${tooltipContent}</div> <!-- Part A - éœ€æ±‚5 & Part C - éœ€æ±‚6 -->
                    <div class="item-controls">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="item-checkbox" ${item.checked ? 'checked' : ''}>
                            å·²æº–å‚™
                        </label>
                        <div class="flex items-center gap-1">
                            <label for="quantity-${item.id}">æ•¸é‡:</label>
                            <input type="number" id="quantity-${item.id}" class="item-quantity" value="${item.quantity}" min="1">
                        </div>
                    </div>
                `;

                container.appendChild(itemElement);

                // Add event listeners for checkbox and quantity input
                const checkbox = itemElement.querySelector('.item-checkbox');
                const quantityInput = itemElement.querySelector('.item-quantity');

                checkbox.addEventListener('change', (event) => {
                    item.checked = event.target.checked;
                    itemElement.classList.toggle('checked', item.checked);
                    updateStateAndSummary();
                });

                quantityInput.addEventListener('change', (event) => {
                    let newQuantity = parseInt(event.target.value, 10);
                    if (isNaN(newQuantity) || newQuantity < 1) {
                        newQuantity = 1; // Ensure quantity is at least 1
                        event.target.value = 1;
                    }
                    item.quantity = newQuantity;
                    // Update item's displayed total price immediately
                    itemElement.querySelector('.item-price').textContent = `NT$ ${(item.price * item.quantity).toLocaleString('zh-TW')}`;
                    updateStateAndSummary();
                });
            });
            updateStateAndSummary(); // Initial summary update after rendering
        }

        // Function to update the summary section and save state
        function updateStateAndSummary() {
            // Update currentItemsState based on disasterKitItems
            disasterKitItems.forEach(item => {
                currentItemsState[item.id] = {
                    checked: item.checked,
                    quantity: item.quantity
                };
            });
            saveState(currentItemsState); // Save the updated state
            updateSummary(); // Update the displayed summary
            renderCategorySummaries(); // Also update category summaries
            updatePieChart(); // Update the pie chart
        }

        // Function to update the progress summary (Part B - éœ€æ±‚1 & Part D - éœ€æ±‚1)
        function updateSummary() {
            const checkedItems = disasterKitItems.filter(item => item.checked);
            const checkedCount = checkedItems.length;
            const totalCount = disasterKitItems.length;
            
            let totalEstimatedCost = 0;
            checkedItems.forEach(item => {
                totalEstimatedCost += item.price * item.quantity;
            });

            document.getElementById('checkedItemsCount').textContent = checkedCount;
            document.getElementById('totalItemsCount').textContent = totalCount;
            document.getElementById('totalEstimatedCost').textContent = `NT$ ${totalEstimatedCost.toLocaleString('zh-TW')}`; // Format with NT$ and comma
        }

        // Function to render category summary cards (Part B - éœ€æ±‚2 & 3, Part D - éœ€æ±‚2 & 3)
        function renderCategorySummaries() {
            const container = document.getElementById('category-summary-container');
            container.innerHTML = ''; // Clear existing summaries

            const categoryTotals = {};
            disasterKitItems.forEach(item => {
                if (item.checked) {
                    if (!categoryTotals[item.category]) {
                        categoryTotals[item.category] = 0;
                    }
                    categoryTotals[item.category] += item.price * item.quantity;
                }
            });

            // Sort categories by importance (Part B - éœ€æ±‚2 & Part D - éœ€æ±‚2)
            const sortedCategories = Object.keys(categoryTotals).sort((a, b) => {
                const importanceA = categoryImportance[a] || 999; // Default high importance for unknown
                const importanceB = categoryImportance[b] || 999;
                return importanceA - importanceB;
            });

            sortedCategories.forEach(categoryName => {
                const card = document.createElement('div');
                card.className = `category-summary-card category-${categoryName}`;
                // Prepend importance number to category name (Part D - éœ€æ±‚2)
                const displayCategoryName = `${categoryImportance[categoryName] || ''}${categoryName}`;
                card.innerHTML = `
                    <span class="emoji">${categoryEmojis[categoryName] || 'â“'}</span> <!-- Part B - éœ€æ±‚3 & Part D - éœ€æ±‚3 -->
                    <h4>${displayCategoryName}</h4>
                    <div class="total-amount">NT$ ${categoryTotals[categoryName].toLocaleString('zh-TW')}</div>
                `;
                container.appendChild(card);
            });
        }

        // Chart.js instance
        let categoryPieChartInstance = null;

        // Function to update the pie chart (Part B - éœ€æ±‚2 & Part D - éœ€æ±‚2)
        function updatePieChart() {
            const ctx = document.getElementById('categoryPieChart').getContext('2d');

            const categoryData = {};
            disasterKitItems.forEach(item => {
                if (item.checked) {
                    if (!categoryData[item.category]) {
                        categoryData[item.category] = 0;
                    }
                    categoryData[item.category] += item.price * item.quantity;
                }
            });

            // Sort categories for chart by amount (descending)
            const sortedChartCategories = Object.keys(categoryData).sort((a, b) => categoryData[b] - categoryData[a]);

            const labels = sortedChartCategories.map(cat => `${categoryImportance[cat] || ''}${cat}`);
            const data = sortedChartCategories.map(cat => categoryData[cat]);

            // Generate dynamic colors for the pie chart
            const backgroundColors = sortedChartCategories.map(cat => {
                switch(cat) {
                    case 'æ¿¾æ°´èˆ‡å„²æ°´': return '#3b82f6'; // blue-500
                    case 'é•·æ•ˆæœŸç³§é£Ÿ': return '#f59e0b'; // amber-500
                    case 'è¡›ç”Ÿèˆ‡é†«ç™‚': return '#ef4444'; // red-500
                    case 'ä¿æš–èˆ‡è¡£': return '#10b981'; // emerald-500
                    case 'èƒ½æºèˆ‡ç‡ƒæ–™': return '#f97316'; // orange-500
                    case 'é€šè¨Š': return '#0ea5e9'; // sky-500
                    case 'é˜²ç«é€ƒç”Ÿ': return '#dc2626'; // red-600
                    case 'åŸºç¤ç¶œåˆ': return '#6b7280'; // gray-500
                    case 'é¤å…·': return '#4b5563'; // gray-700
                    case 'æœå°‹ä¸­': return '#9ca3af'; // gray-400
                    default: return '#cccccc'; // Fallback
                }
            });

            if (categoryPieChartInstance) {
                categoryPieChartInstance.data.labels = labels;
                categoryPieChartInstance.data.datasets[0].data = data;
                categoryPieChartInstance.data.datasets[0].backgroundColor = backgroundColors;
                categoryPieChartInstance.update();
            } else {
                categoryPieChartInstance = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColors,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    font: {
                                        size: 14,
                                        family: 'Inter'
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: 'å·²å‹¾é¸å“é …é¡åˆ¥é‡‘é¡åˆ†ä½ˆ',
                                font: {
                                    size: 18,
                                    family: 'Inter'
                                }
                            }
                        }
                    }
                });
            }
        }


        // --- Part C - éœ€æ±‚1: è‡ªå‹•å¸¶å…¥åŸºæœ¬æ•¸å€¼ ---
        const adultsInput = document.getElementById('adults');
        const childrenInput = document.getElementById('children');
        const daysInput = document.getElementById('days');
        const calculateQuantitiesBtn = document.getElementById('calculateQuantitiesBtn');

        calculateQuantitiesBtn.addEventListener('click', () => {
            const adults = parseInt(adultsInput.value, 10) || 0;
            const children = parseInt(childrenInput.value, 10) || 0;
            const totalPeople = adults + children;
            const days = parseInt(daysInput.value, 10) || 1;

            // Define consumption rates
            const waterPerPersonPerDay = 3; // liters
            const foodUnitsPerPersonPerDay = 2; // units (e.g., rations, meals)

            disasterKitItems.forEach(item => {
                let newCalculatedQuantity = item.initialQuantity; // Default to initial quantity from sheet

                if (item.category === "æ¿¾æ°´èˆ‡å„²æ°´") {
                    // Assuming 1 unit of water item = 1 liter for simplicity in calculation
                    // You might need to adjust this logic if one item unit represents more liters
                    newCalculatedQuantity = Math.ceil((totalPeople * waterPerPersonPerDay * days) / (item.unitConversionFactor || 1));
                    // Ensure minimum 1 if calculated is 0
                    if (newCalculatedQuantity < 1) newCalculatedQuantity = 1;
                } else if (item.category === "é•·æ•ˆæœŸç³§é£Ÿ") {
                    // Assuming 1 unit of food item = 1 food unit for simplicity in calculation
                    // You might need to adjust this logic if one item unit represents more food units
                    newCalculatedQuantity = Math.ceil((totalPeople * foodUnitsPerPersonPerDay * days) / (item.unitConversionFactor || 1));
                    // Ensure minimum 1 if calculated is 0
                    if (newCalculatedQuantity < 1) newCalculatedQuantity = 1;
                }
                
                // Update item's quantity in the data model
                item.quantity = newCalculatedQuantity;
                // Update the input field on the page
                const quantityInput = document.getElementById(`quantity-${item.id}`);
                if (quantityInput) {
                    quantityInput.value = newCalculatedQuantity;
                    // Also update the item's displayed total price immediately
                    const itemElement = quantityInput.closest('.item-card');
                    if(itemElement) {
                        itemElement.querySelector('.item-price').textContent = `NT$ ${(item.price * item.quantity).toLocaleString('zh-TW')}`;
                    }
                }
            });
            updateStateAndSummary(); // Re-render summaries after quantity calculation
        });

        // --- Part C - éœ€æ±‚2: å¿«é€Ÿå…¨éƒ¨å‹¾é¸ ---
        const checkAllBtn = document.getElementById('checkAllBtn');
        checkAllBtn.addEventListener('click', () => {
            disasterKitItems.forEach(item => {
                item.checked = true; // Set all items to checked
                const checkbox = document.querySelector(`.item-card[data-id="${item.id}"] .item-checkbox`);
                const itemElement = checkbox.closest('.item-card');
                if (checkbox && itemElement) {
                    checkbox.checked = true;
                    itemElement.classList.add('checked');
                }
            });
            updateStateAndSummary(); // Update summaries after checking all
        });

        // --- Part C - éœ€æ±‚2: å¿«é€Ÿå…¨éƒ¨å–æ¶ˆ ---
        const uncheckAllBtn = document.getElementById('uncheckAllBtn');
        uncheckAllBtn.addEventListener('click', () => {
            disasterKitItems.forEach(item => {
                item.checked = false; // Set all items to unchecked
                const checkbox = document.querySelector(`.item-card[data-id="${item.id}"] .item-checkbox`);
                const itemElement = checkbox.closest('.item-card');
                if (checkbox && itemElement) {
                    checkbox.checked = false;
                    itemElement.classList.remove('checked');
                }
            });
            updateStateAndSummary(); // Update summaries after unchecking all
        });

        // --- Part C - éœ€æ±‚3: å¿«é€Ÿå›åˆ°é ‚ç«¯ ---
        const scrollToTopBtn = document.getElementById("scrollToTopBtn");

        // When the user scrolls down 20px from the top of the document, show the button
        window.onscroll = function() {
            const floatButtonsContainer = scrollToTopBtn.parentNode; // Get the parent container
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                floatButtonsContainer.style.display = "flex"; // Show the container for buttons
            } else {
                floatButtonsContainer.style.display = "none"; // Hide the container
            }
        };

        // When the user clicks on the button, scroll to the top of the document
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' }); // Smooth scroll
        });

        // --- Part C - éœ€æ±‚4: ç”¢ç”ŸLOGè¨˜éŒ„æª” ---
        const generateLogBtn = document.getElementById('generateLogBtn');
        generateLogBtn.addEventListener('click', () => {
            const logData = disasterKitItems.map(item => ({
                id: item.id,
                name: item.name,
                category: item.category,
                checked: item.checked,
                quantity: item.quantity,
                unitPrice: item.price,
                totalItemCost: item.price * item.quantity,
                link: item.link
            }));

            const jsonString = JSON.stringify(logData, null, 2); // Pretty print JSON
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'é˜²ç½åŒ…ç´€éŒ„_' + new Date().toISOString().slice(0,10) + '.json'; // Filename with date
            document.body.appendChild(a); // Append to body to make it clickable
            a.click(); // Programmatically click the link to trigger download
            document.body.removeChild(a); // Clean up
            URL.revokeObjectURL(url); // Release the object URL
        });

        // --- Part C - éœ€æ±‚4: è¼‰å…¥ç´€éŒ„æª” ---
        const loadLogBtn = document.getElementById('loadLogBtn');
        const loadLogInput = document.getElementById('loadLogInput');

        loadLogBtn.addEventListener('click', () => {
            loadLogInput.click(); // Programmatically click the hidden file input
        });

        loadLogInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const loadedData = JSON.parse(e.target.result);
                    // Apply loaded data to currentItemsState and then to disasterKitItems
                    loadedData.forEach(loadedItem => {
                        const existingItem = disasterKitItems.find(item => item.id === loadedItem.id);
                        if (existingItem) {
                            existingItem.checked = loadedItem.checked;
                            existingItem.quantity = loadedItem.quantity;
                        }
                    });
                    // Re-render the entire list to reflect loaded state
                    renderDisasterKitItems();
                    updateStateAndSummary(); // Update summaries and save to local storage
                    alert('ç´€éŒ„æª”è¼‰å…¥æˆåŠŸï¼'); // Use a simple alert for now, can be replaced with custom modal
                } catch (error) {
                    console.error('è¼‰å…¥ç´€éŒ„æª”å¤±æ•—:', error);
                    alert('è¼‰å…¥ç´€éŒ„æª”å¤±æ•—ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ ¼å¼æ˜¯å¦æ­£ç¢ºã€‚'); // Use a simple alert
                }
            };
            reader.readAsText(file);
        });


        // --- Part C - éœ€æ±‚5: å¿«é€Ÿç”¢ç”Ÿè³¼ç‰©æª¢æ ¸æ¸…å–®PDF ---
        const generatePdfBtn = document.getElementById('generatePdfBtn');
        generatePdfBtn.addEventListener('click', () => {
            const element = document.body; // Target the entire body for PDF generation

            // Options for html2pdf
            const options = {
                margin: 10,
                filename: 'é˜²ç½åŒ…æª¢æ ¸æ¸…å–®_' + new Date().toISOString().slice(0,10) + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' } // orientation: 'landscape' for A4æ©«å‘
            };

            // Use html2pdf to generate and download the PDF
            html2pdf().set(options).from(element).save();
        });


        // Initial render when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            renderDisasterKitItems();
            renderCategorySummaries();
            updatePieChart(); // Initial render of the pie chart
        });
    </script>
</body>
</html>
